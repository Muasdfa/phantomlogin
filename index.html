<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Solana Memecoin Wallet</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- Solana wallet adapter -->
    <script src="https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-base@0.10.0-rc.14/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-wallets@0.10.0-rc.14/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-phantom@0.10.0-rc.14/dist/index.umd.js"></script>
    <style>
      body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
      input, button { font-size: 1rem; padding: .5rem; margin: .3rem 0; }
    </style>
  </head>
  <body>
    <h1>Solana Memecoin Wallet</h1>
    <div id="auth">
      <h2>Sign Up / Log In</h2>
      <input id="email"    type="email"    placeholder="Email" /><br/>
      <input id="password" type="password" placeholder="Password" /><br/>
      <button id="signup">Sign Up</button>
      <button id="login">Log In</button>
      <div id="auth-msg"></div>
    </div>
    <div id="app" style="display:none;">
      <p>Welcome, <span id="user-email"></span>!  
         <button id="logout">Log Out</button></p>
      <button id="connect-wallet">Connect Phantom Wallet</button>
      <p id="wallet-info"></p>
      <h3>Your Balance</h3>
      <p id="balance">-- SOL</p>
      <p>To deposit, simply send SOL to your Phantom address above.</p>
    </div>
    <script>
    // 1) Initialize Firebase
    const firebaseConfig = {
      apiKey:    "YOUR_API_KEY",
      authDomain:"YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      // …rest of your config…
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();

    // 2) Auth handlers
    const authMsg = document.getElementById("auth-msg");
    document.getElementById("signup").onclick = () => {
      const e = email.value, p = password.value;
      auth.createUserWithEmailAndPassword(e,p)
        .then(() => authMsg.textContent="Signed up! Please Log In.")
        .catch(e=>authMsg.textContent=e.message);
    };
    document.getElementById("login").onclick = () => {
      auth.signInWithEmailAndPassword(email.value,password.value)
        .catch(e=>authMsg.textContent=e.message);
    };

    // 3) On auth state change
    auth.onAuthStateChanged(user => {
      if (!user) {
        document.getElementById("auth").style.display = "block";
        document.getElementById("app").style.display  = "none";
        return;
      }
      document.getElementById("auth").style.display = "none";
      document.getElementById("app").style.display  = "block";
      userEmail.textContent = user.email;
    });

    // 4) Connect Phantom
    const { Connection, PublicKey } = solanaWeb3;
    const { PhantomWalletAdapter } = window["@solana/wallet-adapter-phantom"];
    const conn = new Connection("https://api.mainnet-beta.solana.com", "confirmed");
    let walletAdapter = null;

    document.getElementById("connect-wallet").onclick = async () => {
      walletAdapter = new PhantomWalletAdapter();
      await walletAdapter.connect();
      const pubkey = walletAdapter.publicKey.toString();
      walletInfo.textContent = "Address: " + pubkey;
      // save to Firestore under users/{uid}
      const uid = auth.currentUser.uid;
      await db.collection("users").doc(uid).set({ id: uid, pubkey }, { merge:true });
      updateBalance(pubkey);
    };

    // 5) Fetch balance
    async function updateBalance(pubkey) {
      const bal = await conn.getBalance(new PublicKey(pubkey));
      balance.textContent = (bal/1e9).toFixed(4) + " SOL";
    }

    // 6) Log out
    document.getElementById("logout").onclick = () => auth.signOut();
    </script>
  </body>
</html>
